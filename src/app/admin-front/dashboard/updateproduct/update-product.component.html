<ng-container *ngIf="data.product && data.categoryId; else error">
  <!-- Title -->
  <div class="w-full flex py-2.5 px-0 gap-2.5">
    <button type="button" class="md:px-2.5 border-[var(--border-outline)] border" (click)="returnToProductComponent()">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
           class="w-6 h-6">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 15.75L3 12m0 0l3.75-3.75M3 12h18"/>
      </svg>
    </button>
    <h1 class="cx-font-size capitalize">Editing {{ data.product.name }}</h1>
  </div>

  <div class="w-full grid grid-cols-1 lg:grid-cols-2 gap-2.5">
    <!-- Product column -->
    <form class="w-full flex flex-col px-0" [formGroup]="form" *ngIf="data">

      <!-- Contents -->
      <div class="flex-1 " *ngIf="currentProduct$ | async as currentDetails">
        <div class="bg-[var(--white)] mb-2.5 p-2.5 rounded-md border border-solid border-[var(--active)]">
          <div class="cx-font-size mb-1.5"><h2 class="capitalize">general</h2></div>

          <!-- Form-Group (product name)-->
          <div class="mb-2">
            <h3 class="capitalize"><span class="text-red-500">*</span> name</h3>
            <input
              formControlName="name"
              type="text"
              class="p-2.5 w-full flex-1 inline rounded-sm border border-solid border-[var(--border-outline)] capitalize"
            />
          </div>

          <!-- Form-Group (sku, price)-->
          <div class="mb-2 grid gap-3 grid-cols-1 lg:grid-cols-2">
            <!-- SKU -->
            <div>
              <h3 class="uppercase"><span class="text-red-500">*</span> sku</h3>
              <input
                formControlName="sku"
                type="text"
                class="p-2.5 w-full flex-1 inline rounded-sm border border-solid border-[var(--border-outline)] capitalize"
              />
            </div>

            <!-- PRICE -->
            <div>
              <h3 class="capitalize"><span class="text-red-500">*</span> price</h3>
              <input
                formControlName="price"
                type="number"
                class="p-2.5 flex-1 w-full rounded-sm border border-solid border-[var(--border-outline)] capitalize"
              />
            </div>
          </div>

          <!-- Form-Group Category -->
          <div class="mb-2">
            <h3 class="capitalize pb-3.5"><span class="text-red-500">*</span> category</h3>
            <div class="grid grid-cols-2 md:flex md:flex-1 gap-1.5">
              <p class="">{{ data.product.category }}</p>
              <select (change)="onChangeCategory($event)"
                      class="p-1.5 rounded cursor-pointer border border-solid border-[var(--border-outline)]">
                <option [value]="" disabled selected>change?</option>
                <option *ngFor="let cat of categories$ | async" [value]="cat.category">{{ cat.category }}</option>
              </select>
            </div>
          </div>

          <!-- Form-Group Collection -->
          <div class="mb-2">
            <h3 class="capitalize pb-3.5">collection</h3>
            <div class="grid grid-cols-2 md:flex md:flex-1 gap-1.5">
              <p class="">{{ data.product.collection }}</p>
              <select (change)="onChangeCollection($event)"
                      class="p-1.5 rounded cursor-pointer border border-solid border-[var(--border-outline)]"
              >
                <option [value]="" disabled selected>change?</option>
                <option *ngFor="let coll of collections$ | async" [value]="coll.collection">{{ coll.collection }}</option>
              </select>
            </div>
          </div>

          <!-- Form-Group description -->
          <div class="flex flex-col gap-2">
            <h3 class="capitalize"><span class="text-red-500">*</span> description</h3>
            <ckeditor [config]="config" formControlName="desc"></ckeditor>
          </div>

        </div>

        <div class="mb-2.5 p-2.5 rounded-md border border-solid border-[var(--active)] bg-[var(--white)]">
          <div class="mb-1.5"><h2 class="cx-font-size capitalize"><span class="text-red-500">*</span> media</h2></div>
          <div class="flex flex-row flex-wrap items-center gap-2.5">
            <div
              class="basis-1/4 aspect-h-1 aspect-w-1 overflow-hidden rounded-md bg-gray-200 lg:aspect-none"
              *ngFor="let image of currentDetails.urls; let i = index"
              [style]="{ 'flex-grow': i == 0 ? '1' : '0' }"
            >
              <img [src]="image" class="h-full w-full rounded-md object-cover object-center lg:h-full lg:w-full"
                   alt="image">
            </div>
          </div>
        </div>
      </div>

      <!-- Btn ctn -->
      <div class="flex justify-between py-2.5 px-1.5">
        <button
          class="text-white font-bold py-2 px-4 rounded border bg-red-500"
          type="button"
          (click)="returnToProductComponent()">cancel
        </button>

        <button type="submit"
                class="text-white font-bold py-2 px-4 rounded bg-[var(--app-theme)]"
                [disabled]="!form.valid"
                [style]="{ 'background-color': form.valid ? 'var(--app-theme-hover)' : 'var(--app-theme)' }"
                [asyncButton]="onSubmit()"
        >update
        </button>
      </div>
    </form>

    <!-- Product Variants column -->
    <div class="h-fit max-h-2/4 mb-2.5 p-2.5 overflow-auto rounded-md border border-solid border-[var(--active)] bg-[var(--white)]">
      <div class="mb-1.5 flex gap-1.5">
        <h2 class="cx-font-size capitalize">variants</h2>
        <button type="button" (click)="openVariant()">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="w-6 h-6 text-[var(--app-theme)]"
          >
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v6m3-3H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </button>
      </div>

      <ng-container *ngIf="productVariants$ | async as variant" [ngSwitch]="variant.state">
        <ng-container *ngSwitchCase="'LOADING'">
          <div class="h-full p-20 flex justify-center items-center">
            <h1 class="cx-font-size capitalize text-[var(--app-theme-hover)]">
              loading product variants...
            </h1>
          </div>
        </ng-container>

        <ng-container *ngSwitchCase="'ERROR'">
          <div class="p-10 text-3xl text-red-500">
            Error {{ variant.error }}
          </div>
        </ng-container>

        <ng-container *ngSwitchCase="'LOADED'">
          <!-- Table -->
          <div class="" *ngIf="variant.data">
            <app-dynamic-table
              [tHead]="thead"
              [detail]="true"
              [data]="variant.data"
              (eventEmitter)="onDeleteOrUpdateVariant($event)"
            ></app-dynamic-table>
          </div>
        </ng-container>

      </ng-container>

    </div>

  </div>

</ng-container>

<ng-template #error>
  <div class="lg-scr p-10 text-3xl text-red-500">
    <button type="button" class="md:px-2.5 border-[var(--border-outline)] border" (click)="returnToProductComponent()">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
           class="w-6 h-6">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 15.75L3 12m0 0l3.75-3.75M3 12h18"/>
      </svg>
    </button>
    Error retrieving product details
  </div>
</ng-template>
